/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as f}from"@dropins/tools/preact-jsx-runtime.js";import{useState as u,useCallback as p,useEffect as h,useMemo as v}from"@dropins/tools/preact-hooks.js";import{Picker as x}from"@dropins/tools/components.js";import{events as C}from"@dropins/tools/event-bus.js";import{g as w}from"../chunks/customerCompanies.js";import"@dropins/tools/fetch-graphql.js";const I=()=>{const[r,m]=u([]),[c,a]=u({text:"",value:""}),i=p(async()=>{var t,n;try{const e=await w();m(e.customerCompanies),(t=e.currentCompany)!=null&&t.name&&((n=e.currentCompany)!=null&&n.id)&&a({text:e.currentCompany.name,value:e.currentCompany.id})}catch(e){console.error("Failed to load company data:",e)}},[]),s=p(t=>{const e=t.target.value,o=r.find(g=>g.value===e);o&&a(o),C.emit("companyContext/changed",e)},[r]),l=p(()=>{m([]),a({text:"",value:""})},[]),y=p(t=>{t?i():l()},[i,l]),d=p(t=>{m(n=>{const e=n.find(o=>o.value===t);return e&&a(e),n})},[]);return h(()=>{const t=C.on("authenticated",y,{eager:!0}),n=C.on("companyContext/restored",d,{eager:!0});return()=>{var e,o;(e=t==null?void 0:t.off)==null||e.call(t),(o=n==null?void 0:n.off)==null||o.call(n)}},[y,d]),{companies:r,currentCompany:c,handleCompanyChange:s}},F=({ariaLabel:r,...m})=>{const{companies:c,currentCompany:a,handleCompanyChange:i}=I(),s=v(()=>c,[c]);return c.length<2?null:f("div",{...m,children:f(x,{options:s,value:a.value,onChange:i,"aria-label":r||"Select company","aria-describedby":"company-switcher-description"})})};export{F as CompanySwitcher,F as default,I as useCompanyData};
//# sourceMappingURL=CompanySwitcher.js.map
